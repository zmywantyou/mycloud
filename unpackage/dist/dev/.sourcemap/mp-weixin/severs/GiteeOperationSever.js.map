{"version":3,"file":"GiteeOperationSever.js","sources":["severs/GiteeOperationSever.ts"],"sourcesContent":["import { IoutMode } from \"../Mode/IoutMode\"\r\nimport { ICallbackOperation } from \"../Mode/CallbackOperation\"\r\nimport { Path } from \"../Tool/Path\"\r\nimport { CreateUrl, Getype } from \"../Tool/CreateUrl\"\r\nimport { BasePostapi } from \"../Api/BasePostapi\";\r\nimport { IMode } from \"../Mode/IMode\";\nexport class GiteeOperationSever {\r\n\tprivate Store : string;\r\n\tprivate Postapi : BasePostapi | undefined\r\n\tpublic constructor(Store : string | undefined) {\r\n\t\tif (Store === undefined)\r\n\t\t\tthrow new Error(\"Store is null\");\r\n\t\tthis.Store = Store\r\n\t\t//this.Getapi=new BaseGetapi()\r\n\t}\r\n\r\n\tpublic async UpNewFile(nowpath : string, callback : ICallbackOperation) {\r\n\t\tlet Store = this.Store\r\n\t\twx.chooseMessageFile({\r\n\t\t\tcount: 10,\r\n\t\t\ttype: 'all',\r\n\t\t\tsuccess(res) {\r\n\t\t\t\t// tempFilePath可以作为img标签的src属性显示图片\r\n\t\t\t\tconst tempFilePaths = res.tempFiles;\r\n\t\t\t\t//console.log(tempFilePaths)\r\n\t\t\t\t//let numbereach : number = 0;\r\n\t\t\t\tconst uploadPromises = tempFilePaths\r\n\t\t\t\t\t.map((tempFilepath) => {\r\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t\twx.getFileSystemManager().readFile({\r\n\t\t\t\t\t\t\t\tfilePath: tempFilepath.path,\r\n\t\t\t\t\t\t\t\tencoding: 'base64',\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tvar base64 = res.data;\r\n\t\t\t\t\t\t\t\t\tlet create = new CreateUrl(Store)\r\n\t\t\t\t\t\t\t\t\tcreate.Path = Path.joint(nowpath, tempFilepath.name)\r\n\t\t\t\t\t\t\t\t\tlet url = create.Create(Getype.PostNewFile);\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"create url is\" + url);\r\n\t\t\t\t\t\t\t\t\t// var api=new BasePostapi(url);\r\n\t\t\t\t\t\t\t\t\tcreate.setpostdata = base64 as unknown;\r\n\t\t\t\t\t\t\t\t\twx.request({\r\n\t\t\t\t\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\t\t\t\t\t\tdata: create.postdata,\r\n\t\t\t\t\t\t\t\t\t\tsuccess: resolve,\r\n\t\t\t\t\t\t\t\t\t\tfail: (err) => reject(err)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: (err) => reject(err)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t\t callback.CallbackOperation(true,uploadPromises)\r\n\t\t\t},\r\n\t\t\t\r\n            \r\n\t\t})\r\n\t}\r\n\tpublic async DeteFiles(items:IoutMode):Promise<IMode>{\r\n\r\n\t\tlet create = new CreateUrl(this.Store)\r\n\t\tcreate.Sha=items.sha;\r\n\t\tcreate.Path=items.path;\r\n\t\tconst url=create.Create(Getype.Delfile);\r\n\t\tconsole.log(url)\r\n\t\tthis.Postapi=new BasePostapi(url)\r\n\t\treturn this.Postapi.Postapi(\"DELETE\");\r\n\t}\r\n\tpublic async CreateNewFile(filename : string, nowpath : string) : Promise<void> {\r\n\t\ttry {\r\n\t\t\tlet create = new CreateUrl(this.Store);\r\n\t\t\tlet pathurl : string = Path.joint(nowpath, filename)\r\n\t\t\tcreate.Path = Path.joint(pathurl, \".keep\");\r\n\t\t\tvar url = create.Create(Getype.PostNewFile);\r\n\t\t\tconsole.log(url)\r\n\t\t\tthis.Postapi = new BasePostapi(url);\r\n\t\t\tthis.Postapi.Postdata = create.postdata\r\n\t\t\tawait this.Postapi.Postapi();\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\t//console.log(err)\r\n\t\t\tthrow err\r\n\t\t}\r\n\t}\r\n}"],"names":["wx","res","CreateUrl","Path","Getype","uni","BasePostapi"],"mappings":";;;;;;;;;;;AAMO,MAAM,oBAAoB;AAAA,EAGzB,YAAY,OAA4B;AAFvC;AACA;AAEP,QAAI,UAAU;AACP,YAAA,IAAI,MAAM,eAAe;AAChC,SAAK,QAAQ;AAAA,EAEd;AAAA,EAEA,MAAa,UAAU,SAAkB,UAA+B;AACvE,QAAI,QAAQ,KAAK;AACjBA,kBAAAA,KAAG,kBAAkB;AAAA,MACpB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,QAAQ,KAAK;AAEZ,cAAM,gBAAgB,IAAI;AAG1B,cAAM,iBAAiB,cACrB,IAAI,CAAC,iBAAiB;AACtB,iBAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCA,+BAAA,uBAAuB,SAAS;AAAA,cAClC,UAAU,aAAa;AAAA,cACvB,UAAU;AAAA,cACV,SAAS,CAACC,SAAQ;AACjB,oBAAI,SAASA,KAAI;AACb,oBAAA,SAAS,IAAIC,yBAAU,KAAK;AAChC,uBAAO,OAAOC,eAAK,MAAM,SAAS,aAAa,IAAI;AACnD,oBAAI,MAAM,OAAO,OAAOC,eAAA,OAAO,WAAW;AAC1CC,8BAAA,MAAA,MAAA,OAAA,uCAAY,kBAAkB,GAAG;AAEjC,uBAAO,cAAc;AACrBL,8BAAAA,KAAG,QAAQ;AAAA,kBACV;AAAA,kBACA,QAAQ;AAAA,kBACR,MAAM,OAAO;AAAA,kBACb,SAAS;AAAA,kBACT,MAAM,CAAC,QAAQ,OAAO,GAAG;AAAA,gBAAA,CACzB;AAAA,cACF;AAAA,cACA,MAAM,CAAC,QAAQ,OAAO,GAAG;AAAA,YAAA,CACzB;AAAA,UAAA,CACD;AAAA,QAAA,CACD;AACS,iBAAA,kBAAkB,MAAK,cAAc;AAAA,MACjD;AAAA,IAAA,CAGA;AAAA,EACF;AAAA,EACA,MAAa,UAAU,OAA8B;AAEpD,QAAI,SAAS,IAAIE,eAAAA,UAAU,KAAK,KAAK;AACrC,WAAO,MAAI,MAAM;AACjB,WAAO,OAAK,MAAM;AAClB,UAAM,MAAI,OAAO,OAAOE,eAAA,OAAO,OAAO;AAC1BC,kBAAAA,MAAA,MAAA,OAAA,uCAAA,GAAG;AACV,SAAA,UAAQ,IAAIC,gBAAA,YAAY,GAAG;AACzB,WAAA,KAAK,QAAQ,QAAQ,QAAQ;AAAA,EACrC;AAAA,EACA,MAAa,cAAc,UAAmB,SAAkC;AAC3E,QAAA;AACH,UAAI,SAAS,IAAIJ,eAAAA,UAAU,KAAK,KAAK;AACrC,UAAI,UAAmBC,UAAA,KAAK,MAAM,SAAS,QAAQ;AACnD,aAAO,OAAOA,UAAA,KAAK,MAAM,SAAS,OAAO;AACzC,UAAI,MAAM,OAAO,OAAOC,eAAA,OAAO,WAAW;AAC1CC,oBAAAA,MAAA,MAAA,OAAA,uCAAY,GAAG;AACV,WAAA,UAAU,IAAIC,gBAAA,YAAY,GAAG;AAC7B,WAAA,QAAQ,WAAW,OAAO;AACzB,YAAA,KAAK,QAAQ;aAEb,KAAK;AAEL,YAAA;AAAA,IACP;AAAA,EACD;AACD;;"}